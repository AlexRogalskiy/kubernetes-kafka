###################### Filebeat Configuration Example #########################

# This file is an example configuration file highlighting only the most common
# options. The filebeat.reference.yml file from the same directory contains all the
# supported options with more comments. You can use it as a reference.
#
# You can find the full configuration reference here:
# https://www.elastic.co/guide/en/beats/filebeat/index.html

# For more available modules and options, please see the filebeat.reference.yml sample
# configuration file.

#=========================== Filebeat prospectors =============================

filebeat.prospectors:

- type: log

  # Change to true to enable this prospector configuration.
  enabled: true

  # Paths that should be crawled and fetched. Glob based paths.
  paths:
    - /var/log/containers/*.log

  # Required in minikube, probably not an issue elsewhere
  # https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html#_symlinks
  symlinks: true

#============================= Filebeat modules ===============================

filebeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

#============================== Kubernetes ====================================

processors:
- add_kubernetes_metadata:
    in_cluster: true

#================================ Outputs =====================================

#------------------------------ Kafka output ----------------------------------

output.kafka:
  # initial brokers for reading cluster metadata
  hosts: ["kafka-0.broker.kafka.svc.cluster.local:9092", "kafka-1.broker.kafka.svc.cluster.local:9092", "kafka-2.broker.kafka.svc.cluster.local:9092"]

  # message topic selection + partitioning
  #topic: '%{[type]}'
  topic: ops-kube-logs-raw-001
  partition.round_robin:
    reachable_only: false

  client_id: logs_k8s_daemonset
  version: 0.11.0.0
  required_acks: 1
  compression: gzip
  max_message_bytes: 1000000
